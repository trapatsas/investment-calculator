<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Buy vs Rent Investment Calculator</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; padding: 20px;
        }
        .container {
            max-width: 1200px; margin: 0 auto; background: rgba(255,255,255,0.95);
            border-radius: 20px; padding: 40px; box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 { color: #333; margin-bottom: 10px; font-size: 2.5em; text-align: center; background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .subtitle { text-align: center; color: #666; margin-bottom: 30px; }
        .scenarios { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px; }
        .scenario { background: linear-gradient(145deg, #f8f9fa, #e9ecef); border-radius: 15px; padding: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); transition: transform 0.3s ease; }
        .scenario:hover { transform: translateY(-5px); }
        .scenario h2 { color: #495057; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .buy-scenario h2::before { content: "üè†"; font-size: 1.5em; }
        .rent-scenario h2::before { content: "üìà"; font-size: 1.5em; }
        .params { margin-bottom: 20px; }
        .param-group { margin-bottom: 15px; }
        label { display: block; color: #6c757d; font-size: 0.9em; margin-bottom: 5px; }
        input[type="range"] { width: 100%; margin-bottom: 5px; }
        input[type="number"] { width: 100%; padding: 8px 10px; border: 1px solid #dee2e6; border-radius: 8px; }
        .param-value { color: #667eea; font-weight: bold; }
        .results { background: #fff; border-radius: 10px; padding: 15px; margin-top: 15px; }
        .result-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e9ecef; }
        .result-item:last-child { border-bottom: none; font-weight: bold; font-size: 1.2em; margin-top: 10px; padding-top: 15px; border-top: 2px solid #667eea; }
        .final-value { color: #28a745; font-weight: bold; }
        .comparison { background: linear-gradient(135deg, #667eea, #764ba2); color: #fff; border-radius: 15px; padding: 30px; text-align: center; box-shadow: 0 10px 30px rgba(102,126,234,0.3); }
        .winner { font-size: 1.8em; font-weight: bold; margin-bottom: 15px; }
        .difference { font-size: 1.4em; margin-bottom: 20px; }
        .chart-container { background: #fff; border-radius: 15px; padding: 20px; margin-top: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        canvas { max-width: 100%; height: 400px; }
        .risk-analysis { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px; }
        .risk-card { background: #fff; border-radius: 10px; padding: 20px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); }
        .risk-card h3 { color: #495057; margin-bottom: 15px; font-size: 1.1em; }
        .risk-item { padding: 5px 0; color: #6c757d; font-size: 0.95em; }
        .risk-item::before { content: "‚Ä¢ "; color: #667eea; font-weight: bold; }
        details { background: #fff; border: 1px solid #e9ecef; border-radius: 10px; padding: 12px 16px; }
        details summary { cursor: pointer; color: #495057; font-weight: 600; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 10px; }
        @media (max-width: 900px){ .scenarios{ grid-template-columns: 1fr; } .grid-2{ grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <h1>Buy vs Rent & Invest Calculator</h1>
        <p class="subtitle">Financial Projection ‚Äî Athens‚Äëtuned defaults</p>

        <div class="scenario" style="margin-bottom: 30px; background: linear-gradient(145deg, #e3f2fd, #bbdefb);">
            <h2 style="color: #1565c0; margin-bottom: 20px;">‚öôÔ∏è Global Settings</h2>
            <div class="grid-2">
                <div class="param-group">
                    <label>Initial Budget/Investment (‚Ç¨)</label>
                    <input type="range" id="initialBudgetRange" min="50000" max="2000000" step="10000" value="300000">
                    <div class="param-value"><span id="initialBudgetValue">‚Ç¨300,000</span></div>
                </div>
                <div class="param-group">
                    <label>Projection Years</label>
                    <input type="range" id="projectionYearsRange" min="1" max="50" step="1" value="25">
                    <div class="param-value"><span id="projectionYearsValue">25</span> years</div>
                </div>
            </div>
        </div>

        <div class="scenarios">
            <div class="scenario buy-scenario">
                <h2>Buy Scenario</h2>
                <div class="params">
                    <div class="param-group">
                        <label>Annual Property Appreciation</label>
                        <input type="range" id="propertyAppreciation" min="2" max="10" step="0.1" value="5.5">
                        <div class="param-value"><span id="propertyAppreciationValue">5.5</span>%</div>
                    </div>
                    <div class="param-group">
                        <label>Annual Maintenance & Tax (% of value)</label>
                        <input type="range" id="maintenanceCost" min="0.5" max="3" step="0.1" value="1.0">
                        <div class="param-value"><span id="maintenanceCostValue">1.0</span>%</div>
                    </div>
                    <details>
                        <summary>Advanced (Athens costs)</summary>
                        <div class="grid-2">
                            <div class="param-group">
                                <label>Buy-side Closing Costs (taxes, fees)</label>
                                <input type="number" id="buyClosingCost" value="0.0" step="0.1" min="0" />
                            </div>
                            <div class="param-group">
                                <label>Sell-side Costs (agent commission)</label>
                                <input type="number" id="sellCost" value="0.0" step="0.1" min="0" />
                            </div>
                            <div class="param-group">
                                <label>Fixed ENFIA & Fees (‚Ç¨/year)</label>
                                <input type="number" id="fixedFees" value="800" step="50" min="0" />
                            </div>
                            <div class="param-group">
                                <label>Annual Building Depreciation (% of value)</label>
                                <input type="range" id="buildingDepreciation" min="0" max="4" step="0.1" value="1.5">
                                <div class="param-value"><span id="buildingDepreciationValue">1.5</span>%</div>
                            </div>
                        </div>
                    </details>
                </div>
                <div class="results">
                    <div class="result-item"><span>Initial Budget:</span><span id="buyInitialBudget">‚Ç¨300,000</span></div>
                    <div class="result-item"><span>Purchase Price (net of closing):</span><span id="purchasePrice">‚Ç¨0</span></div>
                    <div class="result-item"><span>Total Maintenance & Fees Paid:</span><span id="totalMaintenance">‚Ç¨0</span></div>
                    <div class="result-item"><span>Gross Property Value (<span id="propertyEndYear">2051</span>):</span><span id="propertyValue" class="final-value">‚Ç¨0</span></div>
                    <div class="result-item"><span>Net Sale Proceeds (after selling cost):</span><span id="saleProceeds" class="final-value">‚Ç¨0</span></div>
                    <div class="result-item"><span>Net Worth (After Costs):</span><span id="buyNetWorth" class="final-value">‚Ç¨0</span></div>
                </div>
            </div>

            <div class="scenario rent-scenario">
                <h2>Rent & Invest Scenario</h2>
                <div class="params">
                    <div class="param-group">
                        <label>Nasdaq‚Äë100 Annual Return</label>
                        <input type="range" id="stockReturn" min="6" max="16" step="0.1" value="8.5">
                        <div class="param-value"><span id="stockReturnValue">8.5</span>%</div>
                    </div>
                    <div class="param-group">
                        <label>Annual Rent Increase</label>
                        <input type="range" id="rentIncrease" min="1" max="6" step="0.1" value="4">
                        <div class="param-value"><span id="rentIncreaseValue">4.0</span>%</div>
                    </div>
                    <details>
                        <summary>Advanced (cashflow)</summary>
                        <div class="grid-2">
                            <div class="param-group">
                                <label>Starting Monthly Rent (‚Ç¨)</label>
                                <input type="number" id="startingRent" value="1000" step="50" min="0" />
                            </div>
                            <div class="param-group">
                                <label>Stop if Portfolio Hits Zero</label>
                                <input type="checkbox" id="stopAtZero" checked />
                            </div>
                        </div>
                    </details>
                </div>
                <div class="results">
                    <div class="result-item"><span>Initial Investment:</span><span id="rentInitialInvestment">‚Ç¨300,000</span></div>
                    <div class="result-item"><span>Starting Monthly Rent:</span><span id="startingRentEcho">‚Ç¨1,000</span></div>
                    <div class="result-item"><span>Total Rent Paid:</span><span id="totalRent">‚Ç¨0</span></div>
                    <div class="result-item"><span>Portfolio Value (<span id="portfolioEndYear">2051</span>):</span><span id="portfolioValue" class="final-value">‚Ç¨0</span></div>
                </div>
            </div>
        </div>

        <div class="comparison">
            <div class="winner" id="winnerText">Calculating...</div>
            <div class="difference" id="differenceText"></div>
            <div id="summaryText"></div>
        </div>

        <div class="chart-container">
            <canvas id="wealthChart"></canvas>
        </div>

        <div class="risk-analysis">
            <div class="risk-card">
                <h3>üè† Buy Scenario Risks</h3>
                <div class="risk-item">Illiquid asset ‚Äì harder to sell quickly</div>
                <div class="risk-item">Concentration risk ‚Äì all capital in one asset</div>
                <div class="risk-item">Location-dependent value</div>
                <div class="risk-item">Unexpected maintenance costs</div>
                <div class="risk-item">Property market downturns</div>
                <div class="risk-item">Lower long‚Äërun returns than equities (on average)</div>
            </div>
            <div class="risk-card">
                <h3>üìà Rent & Invest Risks</h3>
                <div class="risk-item">Stock market volatility (tech‚Äëheavy index)</div>
                <div class="risk-item">No owned property after 25 years</div>
                <div class="risk-item">Rising rents reduce investment capital</div>
                <div class="risk-item">Sequence risk (bad early returns)</div>
                <div class="risk-item">Discipline required to stay invested</div>
                <div class="risk-item">FX / geopolitical risks (if unhedged)</div>
            </div>
        </div>
    </div>

    <script>
        console.log('JavaScript is loading...');

        let wealthChart;
        let years = 25;
        let initialCapital = 300000;

        // helpers
        const formatEuro = (n) => `‚Ç¨${Number(n).toLocaleString('en-US', { maximumFractionDigits: 0 })}`;
        const pct = (n) => `${Number(n).toFixed(1)}%`;

        console.log('Script loaded, starting calculations...');

        function calcBuy() {
            const app = parseFloat(document.getElementById('propertyAppreciation').value) / 100;
            const maint = parseFloat(document.getElementById('maintenanceCost').value) / 100;
            const buyClose = parseFloat(document.getElementById('buyClosingCost').value) / 100;
            const sellCost = parseFloat(document.getElementById('sellCost').value) / 100;
            const fixedFees = parseFloat(document.getElementById('fixedFees').value) || 0;
            const buildingDepreciation = parseFloat(document.getElementById('buildingDepreciation').value) / 100;

            // Purchase price net of closing costs
            const purchasePrice = initialCapital / (1 + buyClose);

            let propertyValue = purchasePrice;
            let cumCosts = 0;
            const buyValues = [purchasePrice];

            for (let y = 1; y <= years; y++) {
                // Building depreciates, land appreciates
                const buildingValue = propertyValue * 0.7; // Assume 70% of value is building
                const landValue = propertyValue * 0.3;

                const newBuildingValue = buildingValue * (1 - buildingDepreciation);
                const newLandValue = landValue * (1 + app);

                propertyValue = newBuildingValue + newLandValue;

                const yearMaint = propertyValue * maint + fixedFees;
                cumCosts += yearMaint;
                buyValues.push(Math.max(0, propertyValue - cumCosts));
            }

            const saleProceeds = propertyValue * (1 - sellCost);
            const netWorth = saleProceeds - cumCosts; // initial cash fully used

            // Update UI
            document.getElementById('purchasePrice').textContent = formatEuro(purchasePrice);
            document.getElementById('totalMaintenance').textContent = formatEuro(cumCosts);
            document.getElementById('propertyValue').textContent = formatEuro(propertyValue);
            document.getElementById('saleProceeds').textContent = formatEuro(saleProceeds);
            document.getElementById('buyNetWorth').textContent = formatEuro(netWorth);

            return { buyValues, netWorth };
        }

        function calcRentInvest() {
            const stockReturn = parseFloat(document.getElementById('stockReturn').value) / 100;
            const rentInc = parseFloat(document.getElementById('rentIncrease').value) / 100;
            let monthlyRent = parseFloat(document.getElementById('startingRent').value) || 0;
            const stopAtZero = document.getElementById('stopAtZero').checked;

            document.getElementById('startingRentEcho').textContent = formatEuro(monthlyRent);

            let portfolio = initialCapital;
            let totalRentPaid = 0;
            const rentValues = [portfolio];

            const monthlyReturn = Math.pow(1 + stockReturn, 1/12) - 1;

            for (let y = 1; y <= years; y++) {
                for (let m = 0; m < 12; m++) {
                    portfolio = portfolio * (1 + monthlyReturn) - monthlyRent;
                    totalRentPaid += monthlyRent;
                    if (stopAtZero && portfolio <= 0) { portfolio = 0; }
                }
                monthlyRent = monthlyRent * (1 + rentInc);
                rentValues.push(portfolio);
            }

            document.getElementById('totalRent').textContent = formatEuro(totalRentPaid);
            document.getElementById('portfolioValue').textContent = formatEuro(portfolio);

            return { rentValues, portfolio };
        }

        function updateComparison(buyNW, port) {
            const diff = Math.abs(port - buyNW);
            let winnerText;
            if (port > buyNW) {
                winnerText = 'üìà Rent & Invest Wins!';
            } else if (port < buyNW) {
                winnerText = 'üè† Buy Property Wins!';
            } else {
                winnerText = 'It\'s a tie!';
            }
            document.getElementById('winnerText').textContent = winnerText;

            const smaller = Math.max(1, Math.min(buyNW, port));
            const percentDiff = ((Math.max(buyNW, port) / smaller - 1) * 100).toFixed(1);

            document.getElementById('differenceText').textContent = `${formatEuro(diff)} advantage (+${percentDiff}%)`;

            const roi = (Math.max(buyNW, port) / initialCapital - 1) * 100;
            const label = port > buyNW ? 'Rent & Invest' : 'Buy Property';
            document.getElementById('summaryText').textContent = `The ${label} strategy yields ${percentDiff}% more wealth after ${years} years (${roi.toFixed(1)}% total return).`;
        }

        function updateChart(buyValues, rentValues) {
            const canvas = document.getElementById('wealthChart');
            const ctx = canvas.getContext('2d');

            // Set canvas size
            canvas.width = canvas.offsetWidth;
            canvas.height = 400;

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Calculate bounds
            const maxVal = Math.max(...buyValues, ...rentValues);
            const minVal = Math.min(...buyValues, ...rentValues);
            const padding = 40;
            const chartWidth = canvas.width - 2 * padding;
            const chartHeight = canvas.height - 2 * padding;

            // Draw title
            ctx.fillStyle = '#333';
            ctx.font = '16px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(`Net Worth Projection Over ${years} Years`, canvas.width / 2, 25);

            // Draw axes
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, padding + chartHeight);
            ctx.lineTo(padding + chartWidth, padding + chartHeight);
            ctx.stroke();

            // Helper function to map values to canvas coordinates
            const mapX = (index) => padding + (index / years) * chartWidth;
            const mapY = (value) => padding + chartHeight - ((value - minVal) / (maxVal - minVal)) * chartHeight;

            // Draw Buy Property line
            ctx.strokeStyle = '#28a745';
            ctx.lineWidth = 3;
            ctx.beginPath();
            buyValues.forEach((value, index) => {
                const x = mapX(index);
                const y = mapY(value);
                if (index === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            ctx.stroke();

            // Draw Rent & Invest line
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.beginPath();
            rentValues.forEach((value, index) => {
                const x = mapX(index);
                const y = mapY(value);
                if (index === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            ctx.stroke();

            // Draw legend
            ctx.fillStyle = '#28a745';
            ctx.fillRect(padding + 20, padding + 20, 15, 3);
            ctx.fillStyle = '#333';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('Buy Property (net of costs)', padding + 45, padding + 25);

            ctx.fillStyle = '#667eea';
            ctx.fillRect(padding + 20, padding + 40, 15, 3);
            ctx.fillStyle = '#333';
            ctx.fillText('Rent & Invest', padding + 45, padding + 45);

            // Draw Y-axis labels
            ctx.fillStyle = '#666';
            ctx.font = '10px sans-serif';
            ctx.textAlign = 'right';
            for (let i = 0; i <= 5; i++) {
                const value = minVal + (maxVal - minVal) * (i / 5);
                const y = padding + chartHeight - (i / 5) * chartHeight;
                ctx.fillText('‚Ç¨' + (value / 1000000).toFixed(1) + 'M', padding - 5, y + 3);
            }

            // Draw X-axis labels
            ctx.textAlign = 'center';
            const currentYear = new Date().getFullYear();
            for (let i = 0; i <= 5; i++) {
                const year = currentYear + 1 + (i / 5) * years;
                const x = padding + (i / 5) * chartWidth;
                ctx.fillText(Math.round(year), x, padding + chartHeight + 15);
            }
        }

        function calculateScenarios() {
            console.log('calculateScenarios called');

            // Update global settings from range sliders
            years = parseInt(document.getElementById('projectionYearsRange').value) || 25;
            initialCapital = parseFloat(document.getElementById('initialBudgetRange').value) || 300000;

            // Update range value displays
            document.getElementById('initialBudgetValue').textContent = formatEuro(initialCapital);
            document.getElementById('projectionYearsValue').textContent = years;

            // Update end year displays
            const currentYear = new Date().getFullYear();
            const endYear = currentYear + years;
            document.getElementById('propertyEndYear').textContent = endYear;
            document.getElementById('portfolioEndYear').textContent = endYear;

            // Update budget displays
            document.getElementById('buyInitialBudget').textContent = formatEuro(initialCapital);
            document.getElementById('rentInitialInvestment').textContent = formatEuro(initialCapital);

            // Echo slider numeric values
            document.getElementById('propertyAppreciationValue').textContent = parseFloat(document.getElementById('propertyAppreciation').value).toFixed(1);
            document.getElementById('maintenanceCostValue').textContent = parseFloat(document.getElementById('maintenanceCost').value).toFixed(1);
            document.getElementById('buildingDepreciationValue').textContent = parseFloat(document.getElementById('buildingDepreciation').value).toFixed(1);
            document.getElementById('stockReturnValue').textContent = parseFloat(document.getElementById('stockReturn').value).toFixed(1);
            document.getElementById('rentIncreaseValue').textContent = parseFloat(document.getElementById('rentIncrease').value).toFixed(1);

            try {
                const { buyValues, netWorth: buyNW } = calcBuy();
                const { rentValues, portfolio: port } = calcRentInvest();
                updateComparison(buyNW, port);
                updateChart(buyValues, rentValues);
                console.log('Calculations completed successfully');
            } catch (error) {
                console.error('Error in calculations:', error);
                document.getElementById('winnerText').textContent = 'Error in calculations - check console';
            }
        }

        // Event listeners
        ['propertyAppreciation','maintenanceCost','buildingDepreciation','stockReturn','rentIncrease'].forEach(id => {
            document.getElementById(id).addEventListener('input', calculateScenarios);
        });
        ['buyClosingCost','sellCost','fixedFees','startingRent','stopAtZero'].forEach(id => {
            document.getElementById(id).addEventListener('input', calculateScenarios);
            document.getElementById(id).addEventListener('change', calculateScenarios);
        });

        // Range slider event listeners
        document.getElementById('initialBudgetRange').addEventListener('input', calculateScenarios);
        document.getElementById('projectionYearsRange').addEventListener('input', calculateScenarios);

        // Initial run
        console.log('Setting up event listeners and initial calculation...');
        calculateScenarios();
    </script>
</body>
</html>
